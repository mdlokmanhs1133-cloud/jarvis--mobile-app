name: Build Real Android APK
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Create complete project structure
        run: |
          # Create ALL React files
          mkdir -p public src components
          
          # 1. public/index.html
          cat > public/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
            <meta charset="utf-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <title>Jarvis App</title>
          </head>
          <body>
            <noscript>You need JavaScript to run this app.</noscript>
            <div id="root"></div>
          </body>
          </html>
          EOF
          
          # 2. src/index.js
          cat > src/index.js << 'EOF'
          import React from 'react';
          import ReactDOM from 'react-dom/client';
          import App from './App';
          
          const root = ReactDOM.createRoot(document.getElementById('root'));
          root.render(<App />);
          EOF
          
          # 3. src/App.js
          cat > src/App.js << 'EOF'
          import React from 'react';
          import Dashboard from '../components/Dashboard';
          
          function App() {
            return <Dashboard API='http://localhost:3000' />;
          }
          
          export default App;
          EOF
          
          # 4. components/Dashboard.js
          cat > components/Dashboard.js << 'EOF'
          import React from 'react';
          
          export default function Dashboard({ API }) {
            return (
              <div style={{
                padding: 40,
                backgroundColor: '#0a1929',
                color: 'white',
                minHeight: '100vh',
                fontFamily: 'Arial, sans-serif'
              }}>
                <h1 style={{color: '#00d4ff'}}>ðŸš€ Jarvis Dashboard</h1>
                <p>Connected to API: <strong>{API}</strong></p>
                <p>Android APK Version 1.0.0</p>
                <div style={{
                  marginTop: 30,
                  padding: 20,
                  background: '#1e3a5f',
                  borderRadius: 10
                }}>
                  <h3>ðŸ“± App Features:</h3>
                  <ul>
                    <li>React 18 Powered</li>
                    <li>Android APK Ready</li>
                    <li>Capacitor Mobile</li>
                    <li>Real-time Updates</li>
                  </ul>
                </div>
              </div>
            );
          }
          EOF
          
          # 5. package.json
          cat > package.json << 'EOF'
          {
            "name": "jarvis-mobile",
            "version": "1.0.0",
            "private": true,
            "dependencies": {
              "react": "^18.2.0",
              "react-dom": "^18.2.0",
              "react-scripts": "5.0.1",
              "@capacitor/core": "^5.0.0",
              "@capacitor/cli": "^5.0.0",
              "@capacitor/android": "^5.0.0"
            },
            "scripts": {
              "start": "react-scripts start",
              "build": "react-scripts build",
              "test": "react-scripts test",
              "eject": "react-scripts eject"
            },
            "eslintConfig": {
              "extends": ["react-app"]
            },
            "browserslist": {
              "production": [">0.2%", "not dead", "not op_mini all"],
              "development": ["last 1 chrome version", "last 1 firefox version", "last 1 safari version"]
            }
          }
          EOF
      
      - name: Install all dependencies
        run: npm install
      
      - name: Build React app
        run: npm run build
      
      - name: Setup Capacitor for Android
        run: |
          npx cap init "Jarvis" "com.jarvis.app" --web-dir=build
          npx cap add android
          npx cap sync
      
      - name: Setup Android environment
        uses: android-actions/setup-android@v2
      
      - name: Build Android APK
        run: |
          cd android
          chmod +x gradlew
          ./gradlew assembleDebug
          echo "âœ… REAL APK BUILT!"
          echo "APK location: android/app/build/outputs/apk/debug/"
          ls -lh app/build/outputs/apk/debug/
      
      - name: Upload REAL APK
        uses: actions/upload-artifact@v4
        with:
          name: jarvis-real-apk
          path: android/app/build/outputs/apk/debug/
          retention-days: 7
      
      - name: Create install guide
        run: |
          echo "ðŸŽ‰ JARVIS ANDROID APK READY!" > INSTALL_GUIDE.txt
          echo "=================================" >> INSTALL_GUIDE.txt
          echo "" >> INSTALL_GUIDE.txt
          echo "ðŸ“¦ File: app-debug.apk" >> INSTALL_GUIDE.txt
          echo "ðŸ“± Size: ~20-30 MB" >> INSTALL_GUIDE.txt
          echo "ðŸ• Built: $(date)" >> INSTALL_GUIDE.txt
          echo "" >> INSTALL_GUIDE.txt
          echo "ðŸ“² INSTALLATION:" >> INSTALL_GUIDE.txt
          echo "1. Enable 'Unknown Sources' in Android Settings" >> INSTALL_GUIDE.txt
          echo "2. Download the APK to your phone" >> INSTALL_GUIDE.txt
          echo "3. Open Files app â†’ Tap the APK â†’ Install" >> INSTALL_GUIDE.txt
          echo "" >> INSTALL_GUIDE.txt
          echo "âœ… Features:" >> INSTALL_GUIDE.txt
          echo "- React 18 WebView" >> INSTALL_GUIDE.txt
          echo.- Fullscreen Android App" >> INSTALL_GUIDE.txt
          echo.- Capacitor Native Bridge" >> INSTALL_GUIDE.txt
      
      - uses: actions/upload-artifact@v4
        with:
          name: installation-guide
          path: INSTALL_GUIDE.txt
